<div id="main">
  <div id="map" class="section"></div>
  <div id="form" class="section">
    <%= form_with(url: "/upload", method: "post") do %>
    <%= label_tag(:address, "Address") %>
    <%= text_field_tag(:address) %>

    <%= label_tag(:ppb, "Lead Conc. (ppb)") %>
    <%= text_field_tag(:ppb) %>

    <%= submit_tag("Add Your Data") %>
  <% end %>
</div>
<div id="search" class="section">
  <input id="search" type="text"/>
</div>
<div id="title" class="section"></div>
</div>

<script>
let mapData = [];
function getWeights(ppb) {
  return ppb;
}
<% @points.each do |p| %>
mapData.push({
  location: new google.maps.LatLng(<%= p.latitude %>, <%= p.longitude %>),
  weight: getWeights(<%= p.ppb %>)
});
<% end %>
let mapElem = document.getElementById('map');
let heatmap = new google.maps.visualization.HeatmapLayer({data: mapData});

navigator.geolocation.getCurrentPosition(pos => {
  let center = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
  let map = new google.maps.Map(mapElem, {
    center: center,
    zoom: 13
  });
  heatmap.setMap(map);
}, err => {
  let map = new google.maps.Map(mapElem);
  let geocoder = new google.maps.Geocoder();
  geocoder.geocode({
    'address': 'US'
  }, (results, status) => {
    let ne = results[0].geometry.viewport.getNorthEast();
    let sw = results[0].geometry.viewport.getSouthWest();

    map.fitBounds(results[0].geometry.viewport);
  });
  heatmap.setMap(map);
});
</script>
